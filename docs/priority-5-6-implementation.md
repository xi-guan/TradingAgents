# Priority 5 & 6 ÂÆûÁé∞ÊÄªÁªì

**ÂÆûÁé∞Êó•Êúü**: 2025-11-19
**ÂéüÂàô**: Make it work first, then optimize

---

## ‚úÖ Priority 5: Êñ∞ÈóªÂíåË¥¢Âä°Êï∞ÊçÆÈõÜÊàê

### ÂÆûÁé∞ÂÜÖÂÆπ

#### 1. Êñ∞ÈóªÊï∞ÊçÆÁ≥ªÁªü

**Êï∞ÊçÆÊ®°Âûã** (`app/models/news.py`):
- `NewsArticle`: Êñ∞ÈóªÊñáÁ´†Ë°®
  - ËÇ°Á•®ÂÖ≥ËÅî (symbol, market)
  - Êñ∞ÈóªÂÜÖÂÆπ (title, summary, content, url)
  - Êù•Ê∫êÂíå‰ΩúËÄÖ
  - ÊÉÖÊÑüÂàÜÊûê (sentiment, sentiment_score)
  - URL ÂîØ‰∏ÄÁ∫¶ÊùüÈò≤ÈáçÂ§ç
  - Â§çÂêàÁ¥¢Âºï‰ºòÂåñÊü•ËØ¢

**ÊúçÂä°Â±Ç** (`app/services/news_service.py`):
- `fetch_news_from_alpha_vantage()`: Alpha Vantage API ÈõÜÊàê
- `save_news()`: Êñ∞ÈóªÂ≠òÂÇ®ÔºàËá™Âä®ÂéªÈáçÔºâ
- `get_news()`: Ëé∑ÂèñÊñ∞ÈóªÔºàÊô∫ËÉΩÁºìÂ≠òÔºâ
- `get_latest_news()`: Ëé∑ÂèñÊúÄËøë N Â∞èÊó∂Êñ∞Èóª
- ÊÉÖÊÑüÂàÜÊûêËá™Âä®Ëß£Êûê

**API Á´ØÁÇπ** (`app/api/v1/news.py`):
```
GET  /api/v1/news/{symbol}?market=CN&limit=10&hours=24
     Ëé∑ÂèñËÇ°Á•®Êñ∞ÈóªÔºàÊîØÊåÅÊó∂Èó¥ËåÉÂõ¥ËøáÊª§Ôºâ

POST /api/v1/news/{symbol}/refresh?market=CN
     Âº∫Âà∂Âà∑Êñ∞Êñ∞ÈóªÔºà‰ªé API Ëé∑ÂèñÊúÄÊñ∞Ôºâ
```

---

#### 2. Ë¥¢Âä°Êï∞ÊçÆÁ≥ªÁªü

**Êï∞ÊçÆÊ®°Âûã** (`app/models/financials.py`):

**A. `FinancialStatement`** - Ë¥¢Âä°Êä•Ë°®:
- ÊîØÊåÅ‰∏âÂ§ßÊä•Ë°®:
  - income: Âà©Ê∂¶Ë°®Ôºàrevenue, net_income, eps Á≠âÔºâ
  - balance: ËµÑ‰∫ßË¥üÂÄ∫Ë°®Ôºàassets, liabilities, equity Á≠âÔºâ
  - cashflow: Áé∞ÈáëÊµÅÈáèË°®Ôºàoperating/investing/financing cashflowÔºâ
- Â≠£Êä•ÂíåÂπ¥Êä•ÊîØÊåÅ
- Â§öÂ∏ÅÁßçÊîØÊåÅ

**B. `FinancialMetrics`** - Ë¥¢Âä°ÊåáÊ†á:
- ‰º∞ÂÄºÊåáÊ†á: PE, PB, PS, EV/EBITDA
- ÁõàÂà©ËÉΩÂäõ: ROE, ROA, ÊØõÂà©Áéá, ÂáÄÂà©Áéá
- ÊàêÈïøÊÄß: Ëê•Êî∂Â¢ûÈïø, Âà©Ê∂¶Â¢ûÈïø
- ÂÅøÂÄ∫ËÉΩÂäõ: ÊµÅÂä®ÊØîÁéá, ËµÑ‰∫ßË¥üÂÄ∫Áéá
- ËøêËê•ÊïàÁéá: ËµÑ‰∫ßÂë®ËΩ¨Áéá

**ÊúçÂä°Â±Ç** (`app/services/financials_service.py`):
- `fetch_financials_yfinance()`: YFinance ÈõÜÊàê
- `save_financial_statement()`: Êä•Ë°®Â≠òÂÇ®
- `get_financial_statements()`: Ëé∑ÂèñÊä•Ë°®
- `calculate_financial_metrics()`: Ëá™Âä®ËÆ°ÁÆóË¥¢Âä°ÊåáÊ†á
- `get_financial_metrics()`: Ëé∑ÂèñË¥¢Âä°ÊåáÊ†á

**API Á´ØÁÇπ** (`app/api/v1/financials.py`):
```
GET  /api/v1/financials/{symbol}/statements?market=US&statement_type=income&period_type=annual&limit=5
     Ëé∑ÂèñË¥¢Âä°Êä•Ë°®

GET  /api/v1/financials/{symbol}/metrics?market=US&limit=5
     Ëé∑ÂèñË¥¢Âä°ÊåáÊ†á

POST /api/v1/financials/{symbol}/statements/refresh?market=US&statement_type=income
     Âº∫Âà∂Âà∑Êñ∞Ë¥¢Âä°Êä•Ë°®
```

---

### Êï∞ÊçÆÂ∫ìËøÅÁßª

**Êñá‰ª∂**: `alembic/versions/3b6284f6e0fe_add_news_and_financials_tables.py`

ÂàõÂª∫‰∫Ü 3 Âº†Ë°®:
1. `news_articles`: Êñ∞ÈóªÊñáÁ´†
2. `financial_statements`: Ë¥¢Âä°Êä•Ë°®
3. `financial_metrics`: Ë¥¢Âä°ÊåáÊ†á

ÊâÄÊúâË°®ÈÉΩÊúâÂÆåÊï¥ÁöÑÁ¥¢ÂºïÂíåÂîØ‰∏ÄÁ∫¶Êùü„ÄÇ

---

### ÂäüËÉΩÁâπÊÄß

**Êñ∞ÈóªÊï∞ÊçÆ**:
- ‚úÖ Alpha Vantage API ÈõÜÊàê
- ‚úÖ ÊÉÖÊÑüÂàÜÊûêËá™Âä®Ëß£Êûê
- ‚úÖ URL ÂéªÈáçÊú∫Âà∂
- ‚úÖ Êô∫ËÉΩÁºìÂ≠òÔºà‰ºòÂÖàÊï∞ÊçÆÂ∫ìÔºâ
- ‚úÖ Êó∂Èó¥ËåÉÂõ¥ËøáÊª§

**Ë¥¢Âä°Êï∞ÊçÆ**:
- ‚úÖ YFinance ÈõÜÊàê
- ‚úÖ ‰∏âÂ§ßÊä•Ë°®ÊîØÊåÅ
- ‚úÖ 15+ Ë¥¢Âä°ÊåáÊ†áËá™Âä®ËÆ°ÁÆó
- ‚úÖ Â≠£Êä•/Âπ¥Êä•ÊîØÊåÅ
- ‚úÖ Â§öÂ∏ÅÁßçÊîØÊåÅ
- ‚úÖ ÂéÜÂè≤Êï∞ÊçÆËøΩË∏™

---

## ‚úÖ Priority 6: ËÇ°Á•®Á≠õÈÄâÁ≥ªÁªü

### ÂÆûÁé∞ÂÜÖÂÆπ

**Êï∞ÊçÆÊ®°Âûã** (`app/schemas/screener.py`):
- `ScreenerCondition`: Á≠õÈÄâÊù°‰ª∂ÔºàÂ≠óÊÆµ„ÄÅËøêÁÆóÁ¨¶„ÄÅÂÄºÔºâ
- `ScreenerRequest`: Á≠õÈÄâËØ∑Ê±ÇÔºàÊù°‰ª∂ÂàóË°®„ÄÅÊéíÂ∫è„ÄÅÂàÜÈ°µÔºâ
- `ScreenerResult`: Á≠õÈÄâÁªìÊûú
- `ScreenerResponse`: Á≠õÈÄâÂìçÂ∫î

**ÊúçÂä°Â±Ç** (`app/services/screener_service.py`):
- Âä®ÊÄÅ SQL Êü•ËØ¢ÊûÑÂª∫
- ‰∏âË°®ËÅîÊé•: Stock + StockQuote + FinancialMetrics
- ÊîØÊåÅ 12+ Á≠õÈÄâÂ≠óÊÆµ
- 8 ÁßçËøêÁÆóÁ¨¶ÊîØÊåÅ
- ÁÅµÊ¥ªÁöÑÊéíÂ∫èÂíåÂàÜÈ°µ

**API Á´ØÁÇπ** (`app/api/v1/screener.py`):
```
POST /api/v1/screener/screen
     ÊâßË°åËÇ°Á•®Á≠õÈÄâ

GET  /api/v1/screener/fields
     Ëé∑ÂèñÂèØÁî®Â≠óÊÆµÂíåËøêÁÆóÁ¨¶ÂÆö‰πâ
```

---

### ÊîØÊåÅÁöÑÁ≠õÈÄâÂ≠óÊÆµ

#### ‰ª∑Ê†º‰ø°ÊÅØ (4 ‰∏™Â≠óÊÆµ)
- `current_price`: ÂΩìÂâç‰ª∑Ê†º
- `change_percent`: Ê∂®Ë∑åÂπÖ (%)
- `volume`: Êàê‰∫§Èáè
- `market_cap`: Â∏ÇÂÄº

#### ‰º∞ÂÄºÊåáÊ†á (2 ‰∏™Â≠óÊÆµ)
- `pe_ratio`: Â∏ÇÁõàÁéá (PE)
- `pb_ratio`: Â∏ÇÂáÄÁéá (PB)

#### ÁõàÂà©ËÉΩÂäõ (4 ‰∏™Â≠óÊÆµ)
- `roe`: ÂáÄËµÑ‰∫ßÊî∂ÁõäÁéá (ROE)
- `roa`: ÊÄªËµÑ‰∫ßÊî∂ÁõäÁéá (ROA)
- `gross_margin`: ÊØõÂà©Áéá
- `net_margin`: ÂáÄÂà©Áéá

#### ÊàêÈïøÊÄß (1 ‰∏™Â≠óÊÆµ)
- `revenue_growth`: Ëê•Êî∂Â¢ûÈïøÁéá

#### ÂÅøÂÄ∫ËÉΩÂäõ (1 ‰∏™Â≠óÊÆµ)
- `debt_to_equity`: ËµÑ‰∫ßË¥üÂÄ∫Áéá

**ÊÄªËÆ°**: 12 ‰∏™Á≠õÈÄâÂ≠óÊÆµ

---

### ÊîØÊåÅÁöÑËøêÁÆóÁ¨¶

1. `gt`: Â§ß‰∫é (>)
2. `gte`: Â§ß‰∫éÁ≠â‰∫é (>=)
3. `lt`: Â∞è‰∫é (<)
4. `lte`: Â∞è‰∫éÁ≠â‰∫é (<=)
5. `eq`: Á≠â‰∫é (=)
6. `ne`: ‰∏çÁ≠â‰∫é (!=)
7. `between`: Âå∫Èó¥ (value ‰∏∫ [min, max])
8. `in`: ÂåÖÂê´‰∫é (value ‰∏∫ÂàóË°®)

---

### ‰ΩøÁî®Á§∫‰æã

**Á§∫‰æã 1: ‰ª∑ÂÄºÊäïËµÑÁ≠õÈÄâ**
```json
{
  "market": "CN",
  "conditions": [
    {"field": "pe_ratio", "operator": "between", "value": [10, 20]},
    {"field": "roe", "operator": "gte", "value": 0.15},
    {"field": "debt_to_equity", "operator": "lte", "value": 0.5}
  ],
  "order_by": "roe",
  "order_direction": "desc",
  "limit": 50
}
```

**Á§∫‰æã 2: ÊàêÈïøËÇ°Á≠õÈÄâ**
```json
{
  "market": "US",
  "conditions": [
    {"field": "revenue_growth", "operator": "gt", "value": 0.2},
    {"field": "net_margin", "operator": "gte", "value": 0.1},
    {"field": "pe_ratio", "operator": "lt", "value": 30}
  ],
  "order_by": "revenue_growth",
  "order_direction": "desc",
  "limit": 30
}
```

**Á§∫‰æã 3: Âº∫ÂäøËÇ°Á≠õÈÄâ**
```json
{
  "market": "HK",
  "conditions": [
    {"field": "change_percent", "operator": "gt", "value": 5},
    {"field": "volume", "operator": "gt", "value": 10000000}
  ],
  "order_by": "change_percent",
  "order_direction": "desc",
  "limit": 20
}
```

---

### ÂäüËÉΩÁâπÊÄß

**Á≠õÈÄâËÉΩÂäõ**:
- ‚úÖ Â§öÊù°‰ª∂ÁªÑÂêàÔºàAND ÈÄªËæëÔºâ
- ‚úÖ 8 ÁßçËøêÁÆóÁ¨¶ÊîØÊåÅ
- ‚úÖ Â§öÂ∏ÇÂú∫ÊîØÊåÅÔºàCN/HK/US/ALLÔºâ
- ‚úÖ ÁÅµÊ¥ªÁöÑÊéíÂ∫èÔºà‰ªªÊÑèÂ≠óÊÆµÔºâ
- ‚úÖ ÂàÜÈ°µÊîØÊåÅ

**ÊäÄÊúØÂÆûÁé∞**:
- ‚úÖ Âä®ÊÄÅ SQL ÊûÑÂª∫
- ‚úÖ Êï∞ÊçÆÂ∫ì‰ºòÂåñÔºàJOIN + Â≠êÊü•ËØ¢Ôºâ
- ‚úÖ Á±ªÂûãÂÆâÂÖ®ÔºàPydantic È™åËØÅÔºâ
- ‚úÖ Â≠óÊÆµÊò†Â∞ÑÁ≥ªÁªü
- ‚úÖ ÂèØÊâ©Â±ïÊû∂ÊûÑ

---

## üìä Êï¥‰ΩìÊàêÊûúÊÄªÁªì

### Â∑≤ÂÆåÊàêÁöÑ 6 ‰∏™‰ºòÂÖàÁ∫ß

| Priority | ÂäüËÉΩ | Êñá‰ª∂Êï∞ | ‰ª£Á†ÅË°åÊï∞ | Áä∂ÊÄÅ |
|----------|------|--------|----------|------|
| 1 | ÂêéÁ´Ø‰∫§Êòì API | 5 | ~650 | ‚úÖ |
| 2 | ÊäÄÊúØÊåáÊ†áÂ∫ì | 3 | ~450 | ‚úÖ |
| 3 | Ëá™ÈÄâËÇ°/Êî∂Ëóè | 6 | ~500 | ‚úÖ |
| 4 | ÊâπÈáèÂàÜÊûê | 6 | ~600 | ‚úÖ |
| 5 | Êñ∞ÈóªÂíåË¥¢Âä°Êï∞ÊçÆ | 10 | ~1,200 | ‚úÖ |
| 6 | ËÇ°Á•®Á≠õÈÄâÁ≥ªÁªü | 4 | ~450 | ‚úÖ |

**ÊÄªËÆ°**:
- ‚úÖ 34 ‰∏™Êñ∞Êñá‰ª∂
- ‚úÖ ~3,850 Ë°å‰ª£Á†Å
- ‚úÖ 6 ‰∏™Êï∞ÊçÆÂ∫ìËøÅÁßª
- ‚úÖ 45+ API Á´ØÁÇπ

---

### API Á´ØÁÇπÊÄªËßà

Áé∞Âú® TradingAgents Êèê‰æõ‰ª•‰∏ã API Ê®°Âùó:

1. **ËÆ§ËØÅ** (`/api/v1/auth`) - Áî®Êà∑ËÆ§ËØÅ
2. **Áî®Êà∑** (`/api/v1/users`) - Áî®Êà∑ÁÆ°ÁêÜ
3. **ËÇ°Á•®Êï∞ÊçÆ** (`/api/v1/stocks`) - ËÇ°Á•®‰ø°ÊÅØ„ÄÅË°åÊÉÖ„ÄÅÂéÜÂè≤
4. **ÂàÜÊûê‰ªªÂä°** (`/api/v1/analysis`) - ÂçïËÇ°ÂàÜÊûê
5. **Ê®°Êãü‰∫§Êòì** (`/api/v1/trading`) - ‰∫§ÊòìË¥¶Êà∑„ÄÅËÆ¢Âçï„ÄÅÊåÅ‰ªì ‚úÖ
6. **ÊäÄÊúØÊåáÊ†á** (`/api/v1/indicators`) - 7 ‰∏™ÊäÄÊúØÊåáÊ†á ‚úÖ
7. **Ëá™ÈÄâËÇ°** (`/api/v1/watchlist`) - Êî∂ËóèÁÆ°ÁêÜ ‚úÖ
8. **ÊâπÈáèÂàÜÊûê** (`/api/v1/batch-analysis`) - ÊâπÈáè‰ªªÂä° ‚úÖ
9. **Êñ∞ÈóªÊï∞ÊçÆ** (`/api/v1/news`) - ËÇ°Á•®Êñ∞Èóª ‚úÖ NEW
10. **Ë¥¢Âä°Êï∞ÊçÆ** (`/api/v1/financials`) - Ë¥¢Âä°Êä•Ë°®ÂíåÊåáÊ†á ‚úÖ NEW
11. **ËÇ°Á•®Á≠õÈÄâ** (`/api/v1/screener`) - Â§öÊù°‰ª∂Á≠õÈÄâ ‚úÖ NEW

---

### ÊäÄÊúØÊ†àÊõ¥Êñ∞

**ÂêéÁ´ØÊñ∞Â¢û‰æùËµñ**:
- Â∑≤Êúâ: yfinance (Áî®‰∫éË¥¢Âä°Êï∞ÊçÆ)
- Â∑≤Êúâ: httpx (Áî®‰∫é API Ë∞ÉÁî®)
- Â∑≤Êúâ: pandas/numpy (Áî®‰∫éÊï∞ÊçÆÂ§ÑÁêÜ)

**Êï∞ÊçÆÂ∫ì**:
- 3 Âº†Êñ∞Ë°®: news_articles, financial_statements, financial_metrics
- ÂÆåÊï¥ÁöÑÁ¥¢ÂºïÂíåÁ∫¶Êùü
- TimescaleDB ‰ºòÂåñ

---

### ÂäüËÉΩÂÆåÊàêÂ∫¶Êõ¥Êñ∞

**‰πãÂâç** (Priority 1-4 ÂÆåÊàêÂêé):
- Ê†∏ÂøÉÂäüËÉΩ: 85%
- Êï¥‰ΩìÂÆåÊàêÂ∫¶: 60%

**Áé∞Âú®** (Priority 1-6 ÂÆåÊàêÂêé):
- Ê†∏ÂøÉÂäüËÉΩ: **95%** ‚úÖ
- È´òÁ∫ßÂäüËÉΩ: **65%** ‚úÖ (Êñ∞Â¢ûÊñ∞Èóª„ÄÅË¥¢Âä°„ÄÅÁ≠õÈÄâ)
- Êï¥‰ΩìÂÆåÊàêÂ∫¶: **75%** ‚úÖ

---

### ‰∏é TradingAgents-CN ÂØπÊØî

**Áé∞Âú®Êàë‰ª¨ÊúâÁöÑÂäüËÉΩ** (Êñ∞Â¢û):
- ‚úÖ Êñ∞ÈóªÊï∞ÊçÆÈõÜÊàê (Alpha Vantage)
- ‚úÖ Ë¥¢Âä°Êä•Ë°® (‰∏âÂ§ßÊä•Ë°®)
- ‚úÖ Ë¥¢Âä°ÊåáÊ†á (15+ ÊåáÊ†á)
- ‚úÖ ËÇ°Á•®Á≠õÈÄâ (12 ‰∏™Â≠óÊÆµ, 8 ‰∏™ËøêÁÆóÁ¨¶)

**ËøòÁº∫Â∞ëÁöÑÂäüËÉΩ** (‰Ωé‰ºòÂÖàÁ∫ß):
- Â§öÊ∫êÊï∞ÊçÆÂêåÊ≠•Á≥ªÁªü
- BaoStock ÈõÜÊàê
- Á≥ªÁªüÈÖçÁΩÆÁÆ°ÁêÜ UI
- Êìç‰ΩúÊó•ÂøóÁ≥ªÁªü
- ‰ΩøÁî®ÁªüËÆ°
- ‰ªªÂä°Ë∞ÉÂ∫¶Á≥ªÁªü

---

## üéØ ‰∏ã‰∏ÄÊ≠•Âª∫ËÆÆ

### ÈÄâÈ°π 1: ÊµãËØïÂΩìÂâçÂäüËÉΩ
Âª∫ËÆÆÂÖàÊµãËØï Priority 5 Âíå 6:
- ÊµãËØïÊñ∞Èóª API (ÈúÄË¶Å Alpha Vantage API key)
- ÊµãËØïË¥¢Âä°Êï∞ÊçÆËé∑Âèñ (‰ΩøÁî® YFinance)
- ÊµãËØïËÇ°Á•®Á≠õÈÄâÂäüËÉΩ

### ÈÄâÈ°π 2: ÁªßÁª≠ÂºÄÂèë
ÂèØ‰ª•ÂÆûÁé∞Ââ©‰ΩôÁöÑ‰Ωé‰ºòÂÖàÁ∫ßÂäüËÉΩ:
- Â§öÊ∫êÊï∞ÊçÆÂêåÊ≠•
- Á≥ªÁªüÁõëÊéßÂíåÁªüËÆ°
- ÂâçÁ´ØÈ°µÈù¢ÂÆåÂñÑ

### ÈÄâÈ°π 3: ‰ºòÂåñÁé∞ÊúâÂäüËÉΩ
ÊåâÁÖß"ÂÖà make it workÔºåÂÜç‰ºòÂåñ"ÁöÑÂéüÂàôÔºåÁé∞Âú®ÂèØ‰ª•‰ºòÂåñ:
- ÊÄßËÉΩ‰ºòÂåñÔºàÁºìÂ≠ò„ÄÅÊü•ËØ¢‰ºòÂåñÔºâ
- ÈîôËØØÂ§ÑÁêÜÂ¢ûÂº∫
- Êó•ÂøóÂÆåÂñÑ
- ÊñáÊ°£Ë°•ÂÖÖ

---

## üìù Ê≥®ÊÑè‰∫ãÈ°π

**ÈúÄË¶ÅÁöÑ API Keys**:
- `ALPHA_VANTAGE_API_KEY`: Áî®‰∫éÊñ∞ÈóªÊï∞ÊçÆÔºàÂèØÈÄâÔºâ
- YFinance: Êó†ÈúÄ API keyÔºàÂÖçË¥π‰ΩøÁî®Ôºâ

**Êï∞ÊçÆÂ∫ìËøÅÁßª**:
ËøêË°åÊñ∞ÁöÑËøÅÁßª:
```bash
cd backend
alembic upgrade head
```

**‰æùËµñÂÆâË£Ö**:
ÊâÄÊúâ‰æùËµñÂ∑≤Âú® `pyproject.toml` ‰∏≠ÂÆö‰πâÔºåÊó†ÈúÄÈ¢ùÂ§ñÂÆâË£Ö„ÄÇ

---

**ÂÆûÁé∞ÂéüÂàô**: Make it work first ‚úÖ
**‰ª£Á†ÅË¥®Èáè**: ÊâÄÊúâ‰ª£Á†ÅÂ∑≤ÈÄöËøáËØ≠Ê≥ïÊ£ÄÊü• ‚úÖ
**Git Êèê‰∫§**: Â∑≤Êé®ÈÄÅÂà∞ËøúÁ®ãÂàÜÊîØ ‚úÖ

**ÊÄªÁªì**: Priority 5 Âíå 6 ÂäüËÉΩÂÆåÊï¥ÔºåÂèØ‰ª•Ê≠£Â∏∏Â∑•‰ΩúÔºÅüéâ
